<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>IKEA Home Sensor</title>
    <style type="text/css">
      tr.heading td {
        background-color: black; color: white;
      }
      tr.d0 td {
        background-color: #ffffff; color: black;
      }
      tr.d1 td {
        background-color: #b8b8b8; color: black;
      }
    </style>
    <script src="/chart.min.js"></script>
    <script type="text/javascript">
      function mySensorTimer(){
        const xhttp = new XMLHttpRequest();
        xhttp.responseType = 'json';
        xhttp.onload = function() {
          var jsonResponse = this.response;
          document.getElementById("temp").innerHTML = jsonResponse.temp
          document.getElementById("altitude").innerHTML = jsonResponse.altitude;
          document.getElementById("pressure").innerHTML = jsonResponse.pressure;
          document.getElementById("particle").innerHTML = jsonResponse.particle;
          if (jsonResponse.gas) {
            document.getElementById("gas").innerHTML = jsonResponse.gas;
          } else {
            document.getElementById("rowGas").hidden = true;
          }
          if (jsonResponse.humidity) {
            document.getElementById("humidity").innerHTML = jsonResponse.humidity;
          } else {
            document.getElementById("rowHumidity").hidden = true;
          }
          console.log(this.responseText);
          }
        xhttp.open("GET", "/sensors", true);
        xhttp.send();
      }

      function onBodyLoad(){
        setInterval(mySensorTimer, 5000);

        // Test chart
        const ctx = document.getElementById('myChart');
        dynamicData = {
                labels: [ "0", "-30", "-60", "-90", "-120", "-160" ],
                datasets: [{
                    label: 'temp',
                    data: [24, 22, 23, 25, 22, 23],
                    borderColor: "rgba(255,0,0,1)"
                }, {
                  label: 'pressure',
                  data: [1000, 1002, 1003, 999, 996, 1000],
                  borderColor: "rgba(0,0,255,1)"
                }
              ]
              }
        const myChart = new Chart(ctx, {
            type: 'line',
            data: dynamicData,
            options: {
                scales: {
                    y: {
                        beginAtZero: false
                    }
                }
            }
        });

      }
    </script>
  </head>
  <body id="body" onload="onBodyLoad()">
    <h1>Room Sensor</h1>
    <table>
      <thead>
       <tr class="heading">
        <td>Sensor</td>
        <td>Value</td>
        <td></td>
       </tr>
      </thead>
      <tbody>
      <tr class="d0">
        <td>Temperatur</td>
        <td id="temp">temp</td>
        <td>Â°C</td>
      </tr>
      <tr id="rowHumidity" class="d1">
        <td>Humidity</td>
        <td id="humidity">humidity</td>
        <td>%</td>
      </tr>
      <tr id="rowGas" class="d0">
        <td>Gas</td>
        <td id="gas">gas</td>
        <td> KOhms</td>
      </tr>
      <tr class="d1">
        <td>Altitude</td>
        <td id="altitude">altitude</td>
        <td>m</td>
      </tr>
      <tr class="d0">
        <td>Pressure</td>
        <td id="pressure">pressure</td>
        <td>hPa</td>
      </tr>
      <tr class="d1">
        <td>Particle</td>
        <td id="particle">particle</td>
        <td>micro gram per quibik</td>
      </tr>
    </tbody>
    </table>
    <canvas id="myChart" width="100%" height="100"></canvas>
  </body>
</html>
